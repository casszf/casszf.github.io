<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ORBITE BAGELS AT HOME!</title>

  <link rel="preload" as="font" href="/ArchiveGaramondStd-Italic.woff2" type="font/woff2" crossorigin>

  <style>
    @font-face{
      font-family:"ArchiveGaramond";
      src:url("/ArchiveGaramondStd-Italic.woff2?v=2") format("woff2");
      font-weight:400; font-style:italic; font-display:swap;
    }
    :root{ --bg:#fafafa; --card:#ffffff; --ink:#1f2937; --muted:#6b7280; --ring:#e5e7eb; --brand:#111827; }
    *{box-sizing:border-box}
    body{ margin:0; font-family:"ArchiveGaramond",serif; font-style:italic; background:var(--bg); color:var(--ink); font-size:18px; line-height:1.5; }
    .container{max-width:900px; margin:24px auto; padding:0 16px 64px}
    h1{font-size:32px; margin:0 0 6px}
    h2{font-size:20px; margin:20px 0 8px}
    p{margin:6px 0}
    .card{background:var(--card); border:1px solid var(--ring); border-radius:14px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.05); margin-top:12px}

    .row{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; padding:10px 0; border-bottom:1px dashed #e5e7eb}
    .row:last-child{border-bottom:none}
    .name{font-weight:600}
    .meta{font-size:14px; color:var(--muted)}
    .muted{color:var(--muted); font-size:14px}
    .qty{width:64px; padding:8px; border:1px solid var(--ring); border-radius:10px; background:#fff; font-size:16px; text-align:center}

    .grid-3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:12px}

    input[type="text"], input[type="tel"], textarea, select{
      width:100%; padding:10px 12px; border:1px solid var(--ring); border-radius:10px; font-size:16px; background:#fff
    }

    .choices{display:flex; gap:16px; align-items:center; flex-wrap:wrap}
    .delivery-extra{display:none; margin-top:8px}
    .warning{font-size:14px; color:#b91c1c; background:#fee2e2; border:1px solid #fecaca; padding:10px 12px; border-radius:10px; display:none; margin-top:8px}

    .total{font-size:20px; font-weight:700; display:flex; justify-content:space-between; align-items:center; padding:16px; border:1px solid var(--ring); border-radius:12px; background:#fff}

    .btn{appearance:none; border:none; background:var(--brand); color:#fff; padding:12px 16px; border-radius:12px; font-size:16px; cursor:pointer}
    .btn:disabled{opacity:.5; cursor:not-allowed}

    .disclaimer{font-size:14px; color:#b45309; background:#fff7ed; border:1px solid #fed7aa; padding:10px 12px; border-radius:10px}
    .hidden{display:none !important}

    .row div:last-child { text-align:center; }
  </style>
</head>

<body>
  <div class="container">
    <h1>ORBITE BAGELS AT HOME!</h1>

    <!-- Coordonn√©es -->
    <div class="card">
      <div class="grid-3">
        <div>
          <label for="nom" class="name">nom</label>
          <input id="nom" name="nom" type="text" placeholder="Ton nom de famille" autocomplete="family-name" required />
        </div>
        <div>
          <label for="prenom" class="name">pr√©nom</label>
          <input id="prenom" name="prenom" type="text" placeholder="Ton pr√©nom" autocomplete="given-name" required />
        </div>
        <div>
          <label for="phone" class="name">t√©l√©phone</label>
          <input id="phone" name="phone" type="tel" placeholder="06 12 34 56 78" autocomplete="tel" required />
        </div>
      </div>
    </div>

    <!-- Bagels -->
    <h2>dis-nous ce que tu veux commander</h2>
    <div class="card" id="bagels"></div>

    <!-- Mode -->
    <h2>dis-nous comment tu souhaites r√©cup√©rer ta commande</h2>
    <div class="card">
      <div class="choices">
        <label><input type="radio" name="mode" value="collect" checked> click and collect</label>
        <label><input type="radio" name="mode" value="delivery"> livraison</label>
      </div>

      <!-- Cr√©neaux (obligatoires pour tous) -->
      <div class="slots" id="slots">
        <p class="muted">Choisis un cr√©neau (obligatoire) :</p>
        <div class="grid-2">
          <div>
            <label class="name">Samedi</label>
            <select id="slot-samedi">
              <option value="">‚Äî choisir ‚Äî</option>
              <option>11H30-12H</option>
              <option>12H-12H30</option>
              <option>12H30-13H</option>
              <option>13H-13H30</option>
              <option>13H30-14H</option>
              <option>14H-14H30</option>
              <option>14H30-15H</option>
            </select>
          </div>
          <div>
            <label class="name">Dimanche</label>
            <select id="slot-dimanche">
              <option value="">‚Äî choisir ‚Äî</option>
              <option>11H30-12H</option>
              <option>12H-12H30</option>
              <option>12H30-13H</option>
              <option>13H-13H30</option>
              <option>13H30-14H</option>
              <option>14H-14H30</option>
              <option>14H30-15H</option>
            </select>
          </div>
        

      <!-- Livraison -->
      <div class="delivery-extra" id="delivery-extra">
        <p class="disclaimer">Livraison √† 4,50‚Ç¨.</p>
        <label class="name" for="adresse">adresse de livraison</label>
        <textarea id="adresse" rows="2" placeholder="N¬∞ et rue, code porte, √©tage‚Ä¶" ></textarea>
        <div class="warning" id="delivery-warning">La livraison est disponible pour une commande d‚Äôau moins 15,00 ‚Ç¨ (hors frais de livraison).</div>
      </div>
    </div>

    <!-- Total -->
    <div class="total" id="totalBox">
      <span>total</span>
      <span id="totalAmount">0,00 ‚Ç¨</span>
    </div>

    <div style="margin-top:16px">
      <button class="btn" id="submitBtn">valider commande</button>
    </div>

    <div class="card hidden" id="confirmation">
      <p><strong>commande enregistr√©e!</strong> tu recevras tr√®s rapidement un lien pour r√©gler et confirmer ta commande, si tu as choisi livraison nous te confirmerons l'heure de livraison</p>
    </div>
  </div>

  <script>
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/meoverpl";
    const DELIVERY_MIN = 15.0; // seuil commande pour livraison (hors frais)

    // Recettes : ORIGINAL + SUCR√â
    const BAGELS = [
      {
        key:'original',
        name:'original',
        desc:`truite fum√©e de Banka, cream cheese maison, oignons rouges, aneth, huile d'olive, cornichons, poivres Roellinger`,
        half:8.0,
        whole:16.0
      },
      {
        key:'abj',
        name:'almond butter & jam',
        desc:`beurre d'amande maison et confiture de saison`,
        half:5.0
      }
    ];

    const fmt = new Intl.NumberFormat('fr-FR',{style:'currency',currency:'EUR'});

    // --- Construction UI bagels
    const bagelsBox=document.getElementById('bagels');
    const headerRow=document.createElement('div');
    headerRow.className='row';
    headerRow.style.fontWeight='600';
    headerRow.style.borderBottom='2px solid #e5e7eb';
    headerRow.innerHTML=`<div>recette</div><div>nombre de moiti√©</div>`;
    bagelsBox.appendChild(headerRow);

    BAGELS.forEach(item=>{
      const row=document.createElement('div');
      row.className='row';
      row.innerHTML=`
        <div>
          <div class="name">${item.name}</div>
          ${item.desc ? `<div class="muted">${item.desc}</div>`:''}
          <div class="meta">${fmt.format(item.half)} moiti√© ${item.whole ? ` / ${fmt.format(item.whole)} entier` : ''}</div>
        </div>
        <select class="qty" data-type="bagel" data-key="${item.key}"></select>`;
      bagelsBox.appendChild(row);
    });

    document.querySelectorAll('select.qty').forEach(sel=>{
      for(let i=0;i<=20;i++){
        const opt=document.createElement('option');
        opt.value=i; opt.textContent=i;
        sel.appendChild(opt);
      }
    });

    // --- Cr√©neaux (un seul jour possible)
    const samediSelect=document.getElementById('slot-samedi');
    const dimancheSelect=document.getElementById('slot-dimanche');
    function handleSlotChange(e){
      if(e.target.id==='slot-samedi' && e.target.value!==''){dimancheSelect.value='';}
      else if(e.target.id==='slot-dimanche' && e.target.value!==''){samediSelect.value='';}
    }
    samediSelect.addEventListener('change',handleSlotChange);
    dimancheSelect.addEventListener('change',handleSlotChange);

    // --- Mode & livraison
    const deliveryExtra=document.getElementById('delivery-extra');
    const deliveryWarning=document.getElementById('delivery-warning');
    const modeInputs=document.querySelectorAll('input[name="mode"]');

    function getBagelsSubtotal(){
      let total=0;
      document.querySelectorAll('select.qty[data-type="bagel"]').forEach(sel=>{
        const key=sel.dataset.key;
        const qty=Number(sel.value||0);
        const item=BAGELS.find(b=>b.key===key);
        if(!item) return;
        if(item.whole){
          const pairs=Math.floor(qty/2);
          const singles=qty%2;
          total += pairs*item.whole + singles*item.half;
        }else{
          total += qty*item.half;
        }
      });
      return total;
    }
    function deliveryFee(mode){ return mode==='delivery' ? 4.5 : 0; }

    function updateModeUI(){
      const mode=document.querySelector('input[name="mode"]:checked')?.value;
      deliveryExtra.style.display = (mode==='delivery') ? 'block' : 'none';
      validateDeliveryThreshold();
      computeTotal();
    }
    modeInputs.forEach(r=>r.addEventListener('change',updateModeUI));
    updateModeUI();

    function validateDeliveryThreshold(){
      const mode=document.querySelector('input[name="mode"]:checked')?.value;
      const subtotal=getBagelsSubtotal(); // hors frais
      const blocked = (mode==='delivery' && subtotal < DELIVERY_MIN);
      deliveryWarning.style.display = blocked ? 'block' : 'none';
      return !blocked;
    }

    function computeTotal(){
      const mode=document.querySelector('input[name="mode"]:checked')?.value;
      const subtotal=getBagelsSubtotal();
      const total=subtotal + deliveryFee(mode);
      document.getElementById('totalAmount').textContent=fmt.format(total);
    }

    document.addEventListener('change',e=>{
      if(e.target.matches('select.qty')||e.target.matches('input[name="mode"]')){
        validateDeliveryThreshold();
        computeTotal();
      }
    });
    computeTotal();

    // --- Helpers cr√©neau
    function getChosenSlot(){
      if (samediSelect.value) return { jour:'samedi', creneau:samediSelect.value };
      if (dimancheSelect.value) return { jour:'dimanche', creneau:dimancheSelect.value };
      return { jour:'', creneau:'' };
    }

    // --- Envoi
    const submitBtn=document.getElementById('submitBtn');
    submitBtn.addEventListener('click',async()=>{
      const mode=document.querySelector('input[name="mode"]:checked')?.value;

      // validations
      const nom=document.getElementById('nom').value.trim();
      const prenom=document.getElementById('prenom').value.trim();
      const phone=document.getElementById('phone').value.trim();
      const {jour, creneau}=getChosenSlot();
      const adresse=(mode==='delivery') ? document.getElementById('adresse').value.trim() : "";

      if(!nom){alert("merci d‚Äôindiquer ton nom");return;}
      if(!prenom){alert("merci d‚Äôindiquer ton pr√©nom");return;}
      if(!phone){alert("merci d‚Äôindiquer ton num√©ro de t√©l√©phone");return;}

      if(!jour || !creneau){
        alert("merci de choisir un jour ET un cr√©neau");
        return;
      }

      if(mode==='delivery'){
        if(!validateDeliveryThreshold()){
          alert("la livraison est disponible √† partir de 15,00 ‚Ç¨ de commande (hors frais).");
          return;
        }
        if(!adresse){ alert("merci d‚Äôindiquer ton adresse pour la livraison"); return; }
      }

      const data={
        nom, prenom, phone, mode,
        jour, creneau, creneau_complet:`${jour} ${creneau}`,
        adresse,
        bagels:{},
        total:document.getElementById('totalAmount').textContent,
        _subject:"Nouvelle commande BAGELS AT HOME!",
        _page:location.href
      };

      document.querySelectorAll('select.qty[data-type="bagel"]').forEach(sel=>{
        const q=parseInt(sel.value||'0',10); if(q>0) data.bagels[sel.dataset.key]=q;
      });

      try{
        const res=await fetch(FORMSPREE_ENDPOINT,{
          method:"POST",
          headers:{"Accept":"application/json","Content-Type":"application/json"},
          body:JSON.stringify(data)
        });
        if(res.ok){
          document.querySelectorAll('.container > *:not(#confirmation)').forEach(el=>el.classList.add('hidden'));
          const conf=document.getElementById('confirmation');
          conf.classList.remove('hidden');
          conf.scrollIntoView({behavior:'smooth'});
        }else{
          alert("oops, l‚Äôenvoi a √©chou√©. r√©essaie dans un instant");
        }
      }catch(e){
        alert("impossible d‚Äôenvoyer la commande (connexion ?). r√©essaie üôè");
      }
    });
  </script>
</body>
</html>
