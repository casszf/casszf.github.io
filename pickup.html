<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ORBITE BAGELS AT HOME!</title>
  
  <style>
    /* ===== POLICE PERSO ===== */
    @font-face {
      font-family: "ArchiveGaramondStd-Italic";
      src: url("fonts/ArchiveGaramondStd-Italic.ttf") format("truetype");
      font-weight: normal;
      font-style: italic;
      font-display: swap;
    }

    :root{
      --bg:#fafafa; --card:#ffffff; --ink:#1f2937; --muted:#6b7280;
      --accent:#111827; --ring:#e5e7eb; --brand:#111827;
    }

    *{box-sizing:border-box}

    body {
      margin:0;
      font-family:"ArchiveGaramondStd-Italic", serif;
      background:var(--bg);
      color:var(--ink);
      font-size: 20px; /* ‚Üê taille du texte global (par d√©faut ~16px) */
      line-height: 1.5; /* plus d‚Äôespace entre les lignes */
    }

    .container{max-width:900px; margin:24px auto; padding:0 16px 64px}
    h1{font-size:28px; margin:0 0 6px}
    h2{font-size:18px; margin:20px 0 8px}
    p{margin:6px 0}
    .card{background:var(--card); border:1px solid var(--ring); border-radius:14px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.05); margin-top:12px}
    .row{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; padding:10px 0; border-bottom:1px dashed #e5e7eb}
    .row:last-child{border-bottom:none}
    .name{font-weight:600}
    .meta{font-size:14px; color:var(--muted)}
    .muted{color:var(--muted); font-size:14px}
    .qty{width:64px; padding:8px; border:1px solid var(--ring); border-radius:10px; background:#fff; font-size:16px}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    input[type="text"], input[type="tel"], textarea, select{width:100%; padding:10px 12px; border:1px solid var(--ring); border-radius:10px; font-size:16px; background:#fff}
    .choices{display:flex; gap:16px; align-items:center; flex-wrap:wrap}
    .slots{display:none; margin-top:8px}
    .delivery-extra{display:none; margin-top:8px}
    .total{font-size:20px; font-weight:700; display:flex; justify-content:space-between; align-items:center; padding:16px; border:1px solid var(--ring); border-radius:12px; background:#fff}
    .btn{appearance:none; border:none; background:var(--brand); color:#fff; padding:12px 16px; border-radius:12px; font-size:16px; cursor:pointer}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .disclaimer{font-size:14px; color:#b45309; background:#fff7ed; border:1px solid #fed7aa; padding:10px 12px; border-radius:10px}
    .hidden{display:none !important}
    .tag{font-size:16px; color:#065f46; background:#ecfdf5; border:1px solid #a7f3d0; padding:2px 8px; border-radius:999px; margin-left:8px}
 /* Centrer le texte dans la colonne de droite */
.row div:last-child {
  text-align: center;
}

/* Centrer le texte dans les menus d√©roulants */
.row select.qty {
  text-align: center;
}

/* (Optionnel) Rendre le header un peu plus visible */
.row.header {
  font-weight: 600;
  border-bottom: 2px solid #e5e7eb;
}
  </style>
</head>

<body>
  <div class="container">
    <h1>BAGELS AT HOME!</h1>

    <!-- Coordonn√©es -->
    <div class="card">
      <div class="grid-2">
        <div>
          <label for="prenom" class="name">pr√©nom</label>
          <input id="prenom" name="prenom" type="text" placeholder="Ton pr√©nom" autocomplete="given-name" />
        </div>
        <div>
          <label for="phone" class="name">t√©l√©phone</label>
          <input id="phone" name="phone" type="tel" placeholder="06 12 34 56 78" autocomplete="tel" />
        </div>
      </div>
    </div>

    <!-- Bagels -->
    <h2>dis-nous ce que tu veux commander ?</h2>
    <div class="card" id="bagels"></div>

    <!-- Boissons -->
    <div class="card" id="drinks">
      <div class="row">
        <div>
          <div class="name">th√© glac√© citron & fleur de sureau</div>
          <div class="meta">3,50‚Ç¨</div>
        </div>
        <select class="qty" data-type="drink" data-key="iced_tea"></select>
      </div>
      <div class="row">
        <div>
          <div class="name">matcha latte avoine <span class="tag">chaud ‚Äì click &amp; collect uniquement</span></div>
          <div class="meta">6,00‚Ç¨</div>
        </div>
        <select class="qty" data-type="drink" data-key="matcha"></select>
      </div>
    </div>

    <!-- Mode -->
    <h2>dis-nous comment tu souhaites r√©cup√©rer ta commande ?</h2>
    <div class="card">
      <div class="choices">
        <label><input type="radio" name="mode" value="collect" checked> click and collect</label>
        <label><input type="radio" name="mode" value="delivery"> livraison</label>
      </div>

      <!-- Cr√©neaux -->
      <div class="slots" id="slots">
        <p class="muted">Choisis un cr√©neau :</p>
        <div class="grid-2">
          <div>
            <label class="name">Samedi</label>
            <select id="slot-samedi">
              <option value="">‚Äî choisir ‚Äî</option>
              <option>11H30-12H</option>
              <option>12H-12H30</option>
              <option>12H30-13H</option>
              <option>13H-13H30</option>
              <option>13H30-14H</option>
            </select>
          </div>
          <div>
            <label class="name">Dimanche</label>
            <select id="slot-dimanche">
              <option value="">‚Äî choisir ‚Äî</option>
              <option>11H30-12H</option>
              <option>12H-12H30</option>
              <option>12H30-13H</option>
              <option>13H-13H30</option>
              <option>13H30-14H</option>
            </select>
          </div>
        </div>
        <p class="muted">S√©lectionne <em>un seul</em> cr√©neau (samedi ou dimanche).</p>
      </div>

      <!-- Livraison -->
      <div class="delivery-extra" id="delivery-extra">
        <p class="disclaimer">Livraison √† 2,90‚Ç¨ uniquement dans le 2·µâ, 3·µâ, 4·µâ et 10·µâ.</p>
        <label class="name" for="adresse">adresse de livraison</label>
        <textarea id="adresse" rows="2" placeholder="N¬∞ et rue, code porte, √©tage‚Ä¶"></textarea>
      </div>
    </div>

    <!-- Total -->
    <div class="total" id="totalBox">
      <span>total</span>
      <span id="totalAmount">0,00 ‚Ç¨</span>
    </div>
    <p class="muted" id="totalNote">les montants des bagels tiennent compte du fait que chaque paire de moiti√©s d‚Äôune m√™me recette est compt√©e comme 1 entier quand le prix entier existe.</p>

    <div style="margin-top:16px">
      <button class="btn" id="submitBtn">valider commande</button>
    </div>

    <div class="card hidden" id="confirmation">
      <p><strong>commande enregistr√©e!</strong> tu recevras tr√®s rapidement un lien pour r√©gler et confirmer ta commande ü•Ø, si tu as choisi livraison nous te confirmerons l'heure de livraison</p>
    </div>
  </div>

  <script>
    /* ===== CONFIG ===== */
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/manprywb";

    const BAGELS = [
      { key:'original', name:'original', desc:`truite fum√©e de Banka, cream cheese maison, oignons rouges, aneth, huile d'olive, cornichons, poivres Roellinger`, half:8.0, whole:14.0 },
      { key:'eggs', name:'eggs', desc:`≈ìufs brouill√©s, cream cheese maison, huile d'olive, noix de muscade, ciboulette, √©pices Roellinger`, half:7.0, whole:12.0 },
      { key:'peters', name:`peter's favorite`, desc:`concombres, cream cheese maison, huile d'olive, sumac, poivres Roellinger`, half:6.0, whole:11.0 },
      { key:'high_summer', name:'high summer', desc:`tomates, cream cheese maison, huile d'olive, poivres Roellinger`, half:6.0, whole:11.0 },
      { key:'high_summer_deluxe', name:'high summer deluxe', desc:`tomates, sardines, cream cheese maison, huile d'olive, poivres Roellinger`, half:7.0, whole:12.0 },
      { key:'abj', name:'almond butter & jam', desc:`beurre d'amande maison et confiture de saison`, half:5.0 }
    ];

    const DRINKS = {
      iced_tea: { name:'th√© glac√©', price:3.5 },
      matcha: { name:'matcha latte avoine (chaud ‚Äì C&C)', price:6.0, collectOnly:true }
    };

    const fmt = new Intl.NumberFormat('fr-FR', { style:'currency', currency:'EUR' });

    /* ===== G√©n√©ration des bagels ===== */
    const bagelsBox = document.getElementById('bagels');
    BAGELS.forEach(item => {
      const headerRow = document.createElement('div');
headerRow.className = 'row';
headerRow.style.fontWeight = '600';
headerRow.style.borderBottom = '2px solid #e5e7eb'; // jolie s√©paration
headerRow.innerHTML = `
  <div style="padding-left:4px;">recette</div>
  <div style="text-align:center;">nombre de moiti√©</div>
`;
bagelsBox.appendChild(headerRow);
bagelsBox.appendChild(headerRow);
      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = `
        <div>
          <div class="name">${item.name}</div>
          ${item.desc ? `<div class="muted">${item.desc}</div>` : ''}
          <div class="meta">
            ${fmt.format(item.half)} moiti√©
            ${
              item.whole != null
                ? ` / ${fmt.format(item.whole)} entier`
                : ` / <span class="muted">pas de prix entier</span>`
            }
          </div>
        </div>
        <select class="qty" data-type="bagel" data-key="${item.key}"></select>
      `;
      bagelsBox.appendChild(row);
    });

    /* ===== Remplir options quantit√© ===== */
    document.querySelectorAll('select.qty').forEach(sel=>{
      for(let i=0;i<=9;i++){
        const opt=document.createElement('option');
        opt.value=i; opt.textContent=i;
        sel.appendChild(opt);
      }
    });

    /* ===== Cr√©neaux samedi/dimanche exclusifs ===== */
    const samediSelect=document.getElementById('slot-samedi');
    const dimancheSelect=document.getElementById('slot-dimanche');
    function handleSlotChange(e){
      if(e.target.id==='slot-samedi' && e.target.value!==''){dimancheSelect.value='';}
      else if(e.target.id==='slot-dimanche' && e.target.value!==''){samediSelect.value='';}
    }
    samediSelect.addEventListener('change',handleSlotChange);
    dimancheSelect.addEventListener('change',handleSlotChange);

    /* ===== UI collecte / livraison ===== */
    const slots=document.getElementById('slots');
    const deliveryExtra=document.getElementById('delivery-extra');
    const modeInputs=document.querySelectorAll('input[name="mode"]');
    function updateModeUI(){
      const mode=document.querySelector('input[name="mode"]:checked')?.value;
      const isCollect=mode==='collect';
      slots.style.display=isCollect?'block':'none';
      deliveryExtra.style.display=!isCollect?'block':'none';
      const matchaSelect=document.querySelector('select.qty[data-key="matcha"]');
      if(matchaSelect){ if(isCollect){matchaSelect.disabled=false;} else{matchaSelect.value='0';matchaSelect.disabled=true;} }
      computeTotal();
    }
    modeInputs.forEach(r=>r.addEventListener('change',updateModeUI));
    updateModeUI();

    /* ===== Calcul du total ===== */
    function computeBagelsTotal(){
  let total = 0;

  document.querySelectorAll('select.qty[data-type="bagel"]').forEach(sel => {
    const key = sel.dataset.key;
    const qty = Number(sel.value || 0);
    const item = BAGELS.find(b => b.key === key);
    if (!item || !Number.isFinite(qty) || qty <= 0) return;

    // ‚ö†Ô∏è On ne fait la r√®gle "2 moiti√©s = 1 entier" que si un prix entier est d√©fini
    const hasWhole = typeof item.whole === 'number' && Number.isFinite(item.whole);

    if (hasWhole) {
      const pairs = Math.floor(qty / 2);   // ex: 4 ‚Üí 2 paires
      const singles = qty % 2;             // ex: 4 ‚Üí 0 reste
      total += (pairs * item.whole) + (singles * item.half);
    } else {
      total += qty * item.half;            // ex: AB&J (pas de prix entier)
    }
  });

  return total;
}
    function computeDrinksTotal(){
      let total=0;
      document.querySelectorAll('select.qty[data-type="drink"]').forEach(sel=>{
        const key=sel.dataset.key;
        const qty=parseInt(sel.value||'0',10);
        const item=DRINKS[key];
        if(item) total+=qty*item.price;
      });
      return total;
    }
    function computeDeliveryFee(){
      const mode=document.querySelector('input[name="mode"]:checked')?.value;
      return mode==='delivery'?2.9:0;
    }
    function computeTotal(){
      const total=computeBagelsTotal()+computeDrinksTotal()+computeDeliveryFee();
      document.getElementById('totalAmount').textContent=fmt.format(total);
    }
    document.addEventListener('change',e=>{
      if(e.target.matches('select.qty')||e.target.matches('input[name="mode"]')) computeTotal();
    });
    computeTotal();

    /* ===== Envoi Formspree ===== */
    const submitBtn=document.getElementById('submitBtn');
    submitBtn.addEventListener('click',async()=>{
      const mode=document.querySelector('input[name="mode"]:checked')?.value;
      const data={
        prenom:document.getElementById('prenom').value.trim(),
        phone:document.getElementById('phone').value.trim(),
        mode,
        creneau:mode==='collect'?(samediSelect.value||dimancheSelect.value||""):"",
        adresse:mode==='delivery'?document.getElementById('adresse').value.trim():"",
        bagels:{}, boissons:{},
        total:document.getElementById('totalAmount').textContent,
        _subject:"Nouvelle commande BAGELS AT HOME!",
        _page:location.href
      };
      document.querySelectorAll('select.qty[data-type="bagel"]').forEach(sel=>{
        const q=parseInt(sel.value||'0',10); if(q>0) data.bagels[sel.dataset.key]=q;
      });
      document.querySelectorAll('select.qty[data-type="drink"]').forEach(sel=>{
        const q=parseInt(sel.value||'0',10); if(q>0) data.boissons[sel.dataset.key]=q;
      });
      if(!data.prenom){alert("merci d‚Äôindiquer ton pr√©nom");return;}
      if(!data.phone){alert("merci d‚Äôindiquer ton num√©ro de t√©l√©phone");return;}
      if(mode==='collect'&&!data.creneau){alert("merci de choisir un cr√©neau");return;}
      if(mode==='delivery'&&!data.adresse){alert("merci d‚Äôindiquer ton adresse");return;}
      try{
        const res=await fetch(FORMSPREE_ENDPOINT,{
          method:"POST",
          headers:{"Accept":"application/json","Content-Type":"application/json"},
          body:JSON.stringify(data)
        });
        if(res.ok){
          document.querySelectorAll('.container > *:not(#confirmation)').forEach(el=>el.classList.add('hidden'));
          const conf=document.getElementById('confirmation');
          conf.classList.remove('hidden');
          conf.scrollIntoView({behavior:'smooth'});
        } else {
          alert("oops, l‚Äôenvoi a √©chou√©. r√©essaie dans un instant");
        }
      }catch(e){
        console.error(e);
        alert("impossible d‚Äôenvoyer la commande (connexion ?). r√©essaie üôè");
      }
    });
  </script>
</body>
</html>
