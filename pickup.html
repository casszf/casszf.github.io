<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ORBITE BAGELS AT HOME!</title>
  <style>
    @font-face{
      font-family: "ArchiveGaramondStd-Italic";
      src: url("fonts/ArchiveGaramondStd-Italic.ttf") format ("truetype");
    font-weight: normal;
      font-style: normal;
    }
      body {
        font-family:"ArchiveGaramondStd-Italic", sans-serif;
    }
        
      :root{
      --bg:#fafafa; --card:#ffffff; --ink:#1f2937; --muted:#6b7280; --accent:#111827;
      --ring:#e5e7eb; --brand:#111827;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"Noto Sans",sans-serif; background:var(--bg); color:var(--ink)}
    .container{max-width:900px; margin:24px auto; padding:0 16px 64px}
    h1{font-size:28px; margin:0 0 6px}
    h2{font-size:18px; margin:20px 0 8px}
    p{margin:6px 0}
    .card{background:var(--card); border:1px solid var(--ring); border-radius:14px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.05); margin-top:12px}
    .row{display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; padding:10px 0; border-bottom:1px dashed #e5e7eb}
    .row:last-child{border-bottom:none}
    .name{font-weight:600}
    .meta{font-size:14px; color:var(--muted)}
    .qty{width:64px; padding:8px; border:1px solid var(--ring); border-radius:10px; background:#fff; font-size:16px}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    input[type="text"], input[type="tel"], textarea, select{width:100%; padding:10px 12px; border:1px solid var(--ring); border-radius:10px; font-size:16px; background:#fff}
    .choices{display:flex; gap:16px; align-items:center; flex-wrap:wrap}
    .muted{color:var(--muted); font-size:14px}
    .slots{display:none; margin-top:8px}
    .delivery-extra{display:none; margin-top:8px}
    .total{font-size:20px; font-weight:700; display:flex; justify-content:space-between; align-items:center; padding:16px; border:1px solid var(--ring); border-radius:12px; background:#fff}
    .btn{appearance:none; border:none; background:var(--brand); color:#fff; padding:12px 16px; border-radius:12px; font-size:16px; cursor:pointer}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .disclaimer{font-size:14px; color:#b45309; background:#fff7ed; border:1px solid #fed7aa; padding:10px 12px; border-radius:10px}
    .hidden{display:none !important}
    .tag{font-size:12px; color:#065f46; background:#ecfdf5; border:1px solid #a7f3d0; padding:2px 8px; border-radius:999px; margin-left:8px}
    .strike{ text-decoration: line-through; opacity:.7; }
  </style>
</head>
<body>
  <div class="container">
    <h1>BAGELS AT HOME!</h1>
  

    <!-- Coordonnées -->
    <div class="card">
      <div class="grid-2">
        <div>
          <label for="prenom" class="name">prénom</label>
          <input id="prenom" name="prenom" type="text" placeholder="Ton prénom" autocomplete="given-name" />
        </div>
        <div>
          <label for="phone" class="name">téléphone</label>
          <input id="phone" name="phone" type="tel" placeholder="06 12 34 56 78" autocomplete="tel" />
        </div>
      </div>
    </div>

    <!-- bagels -->
    <h2>dis-nous ce que tu veux commander ?</h2>
    <div class="card" id="bagels">
      <!-- Les lignes sont générées par JS depuis la configuration des produits -->
    </div>

    <!-- boissons -->
    <div class="card" id="drinks">
      <div class="row">
        <div>
          <div class="name">thé glacé citron & fleur de sureau</div>
          <div class="meta">3,50€</div>
        </div>
        <select class="qty" data-type="drink" data-key="iced_tea" aria-label="Quantité Thé glacé">
          <!-- options 0..9 ajoutées en JS -->
        </select>
      </div>
      <div class="row">
        <div>
          <div class="name">matcha latte avoine <span class="tag">chaud – click &amp; collect uniquement</span></div>
          <div class="meta">6,00€</div>
        </div>
        <select class="qty" data-type="drink" data-key="matcha" aria-label="Quantité Matcha latte avoine">
        </select>
      </div>
    </div>

    <!-- Mode de retrait / livraison -->
    <h2>Dis-nous comment tu souhaites récupérer ta commande ?</h2>
    <div class="card">
      <div class="choices" role="radiogroup" aria-label="Mode de récupération">
        <label><input type="radio" name="mode" value="collect" checked> click and collect</label>
        <label><input type="radio" name="mode" value="delivery"> livraison</label>
      </div>

      <!-- Slots click & collect -->
      <div class="slots" id="slots">
  <p class="muted" style="margin-top:8px">Choisis un créneau :</p>
  <div class="grid-2">
    <div>
      <label class="name">Samedi</label>
      <select id="slot-samedi">
        <option value="">— choisir —</option>
        <option>11H30-12H</option>
        <option>12H-12H30</option>
        <option>12H30-13H</option>
        <option>13H-13H30</option>
        <option>13H30-14H</option>
      </select>
    </div>
    <div>
      <label class="name">Dimanche</label>
      <select id="slot-dimanche">
        <option value="">— choisir —</option>
        <option>11H30-12H</option>
        <option>12H-12H30</option>
        <option>12H30-13H</option>
        <option>13H-13H30</option>
        <option>13H30-14H</option>
      </select>
    </div>
  </div>
  <p class="muted">Sélectionne <em>un seul</em> créneau (samedi <strong>ou</strong> dimanche).</p>
</div>

      <!-- Infos livraison -->
      <div class="delivery-extra" id="delivery-extra">
        <p class="disclaimer">Livraison à 2,90€ uniquement dans le 2ᵉ, 3ᵉ, 4ᵉ et 10ᵉ.</p>
        <label class="name" for="adresse">adresse de livraison</label>
        <textarea id="adresse" rows="2" placeholder="N° et rue, code porte, étage…"></textarea>
      </div>
    </div>

    <!-- Total -->
    <div class="total" id="totalBox">
      <span>total</span>
      <span id="totalAmount">0,00 €</span>
    </div>
    <p class="muted" id="totalNote" style="margin:6px 2px 0">
      les montants des bagels tiennent compte du fait que chaque paire de moitiés d’une <strong>même recette</strong> est comptée comme 1 entier quand le prix entier existe.
    </p>

    <!-- CTA -->
    <div style="margin-top:16px">
      <button class="btn" id="submitBtn">valider commande</button>
    </div>

    <!-- Confirmation -->
    <div class="card hidden" id="confirmation">
      <p><strong>commande enregistrée!</strong> tu recevras très rapidement un lien pour régler et confirmer ta commande, si tu as choisi livraison nous te confirmerons l'heure de livraison</p>
    </div>
  </div>

  <script>
    // ===== Config produits =====
    // Rappel de la règle: pour chaque recette, toutes les 2 quantités = 1 entier (si un prix entier est défini).
    // Si une recette n'a PAS de prix "entier", on compte simplement 2 moitiés sans réduction.
    const BAGELS = [
      { key: 'original', name: 'original', desc: 'truite fumée de Banka, cream cheese maison, oignons rouges, aneth, huile d'olive, cornichons, poivres Roellinger', half: 8.0, whole: 14.0 },
      { key: 'eggs', name: 'eggs', desc: 'oeufs brouillés, cream cheese maison, huile d'olive, noix de muscade, ciboulette, épices Roellinger', half: 7.0, whole: 12.0 },
      { key: 'peters', name: 'peter's favorite', desc:'concombres, cream cheese maison, huile d'olive, sumac, poivres Roellinger', half: 6.0, whole: 11.0 },
      { key: 'high_summer', name: 'high summer', desc: 'tomates, cream cheese maison, huile d'olive, poivres Roellinger', half: 6.0, whole: 11.0 },
      { key: 'high_summer_deluxe', name: 'high summer deluxe', desc: 'tomates, sardines, cream cheese maison, huile d'olive, poivres Roellinger', half: 7.0, whole: 12.0 },
      { key: 'abj', name: 'almond butter & jam', desc: 'beurre d'amande maison et confiture de saison', half: 5.0 } // pas de prix entier fourni
    ];

    const DRINKS = {
      iced_tea: { name: 'thé glacé', price: 3.5 },
      matcha: { name: 'matcha latte avoine (chaud – C&C)', price: 6.0, collectOnly: true }
    };

    const fmt = new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' });

    // ===== Génération des lignes bagels =====
    const bagelsBox = document.getElementById('bagels');
    BAGELS.forEach(item => {
      const row = document.createElement('div');
      row.className = 'row';
      row.innerHTML = `
        <div>
          <div class="name">${item.name}</div>
          ${item.desc ? `<div class="muted">${item.desc}</div>`:''}
          <div class="meta">
            ${fmt.format(item.half)} moitié
            ${
              item.whole != null
                ? ` / ${fmt.format(item.whole)} entier`
                : ` / <span class="muted">pas de prix entier</span>`
            }
          </div>
        </div>
        <select class="qty" data-type="bagel" data-key="${item.key}" aria-label="Quantité ${item.name}">
        </select>
      `;
      bagelsBox.appendChild(row);
    });

    // ===== Remplir toutes les listes déroulantes de 0..9 =====
    function fillQtySelects(){
      document.querySelectorAll('select.qty').forEach(sel => {
        sel.innerHTML = '';
        for(let i=0;i<=9;i++){
          const opt = document.createElement('option');
          opt.value = String(i);
          opt.textContent = i;
          sel.appendChild(opt);
        }
        sel.value = '0';
      });
    }
    fillQtySelects();

    // ===== UI: mode collecte / livraison =====
    const slots = document.getElementById('slots');
    const deliveryExtra = document.getElementById('delivery-extra');
    const modeInputs = document.querySelectorAll('input[name="mode"]');

    function updateModeUI(){
      const mode = document.querySelector('input[name="mode"]:checked')?.value;
      const isCollect = mode === 'collect';
      slots.style.display = isCollect ? 'block' : 'none';
      deliveryExtra.style.display = !isCollect ? 'block' : 'none';

      // ===== Empêcher la sélection de 2 créneaux =====
const samediSelect = document.getElementById('slot-samedi');
const dimancheSelect = document.getElementById('slot-dimanche');

function handleSlotChange(e) {
  if (e.target.id === 'slot-samedi' && e.target.value !== '') {
    // Si on choisit un créneau samedi → on vide dimanche
    dimancheSelect.value = '';
  } else if (e.target.id === 'slot-dimanche' && e.target.value !== '') {
    // Si on choisit un créneau dimanche → on vide samedi
    samediSelect.value = '';
  }
}

samediSelect.addEventListener('change', handleSlotChange);
dimancheSelect.addEventListener('change', handleSlotChange);

      // Matcha: uniquement en click & collect
      const matchaSelect = document.querySelector('select.qty[data-key="matcha"]');
      if(matchaSelect){
        if(isCollect){
          matchaSelect.disabled = false;
        }else{
          matchaSelect.value = '0';
          matchaSelect.disabled = true;
        }
      }
      computeTotal();
    }
    modeInputs.forEach(r => r.addEventListener('change', updateModeUI));
    updateModeUI();

    // ===== Calcul du total =====
    function computeBagelsTotal(){
      let total = 0;
      document.querySelectorAll('select.qty[data-type="bagel"]').forEach(sel => {
        const key = sel.dataset.key;
        const qty = parseInt(sel.value || '0', 10);
        const item = BAGELS.find(b => b.key === key);
        if(!item) return;

        if(item.whole != null){
          const pairs = Math.floor(qty / 2);
          const singles = qty % 2;
          total += pairs * item.whole + singles * item.half;
        }else{
          // Pas de prix entier => on facture à la moitié
          total += qty * item.half;
        }
      });
      return total;
    }

    function computeDrinksTotal(){
      let total = 0;
      document.querySelectorAll('select.qty[data-type="drink"]').forEach(sel => {
        const key = sel.dataset.key;
        const qty = parseInt(sel.value || '0', 10);
        const item = DRINKS[key];
        if(!item) return;
        total += qty * item.price;
      });
      return total;
    }

    function computeDeliveryFee(){
      const mode = document.querySelector('input[name="mode"]:checked')?.value;
      return mode === 'delivery' ? 2.9 : 0;
    }

    function computeTotal(){
      const total = computeBagelsTotal() + computeDrinksTotal() + computeDeliveryFee();
      document.getElementById('totalAmount').textContent = fmt.format(total);
    }

    // Recalcul à chaque changement pertinent
    document.addEventListener('change', (e) => {
      const t = e.target;
      if(t.matches('select.qty') || t.matches('input[name="mode"]')){
        computeTotal();
      }
    });

    // Initial
    computeTotal();

    // ===== Soumission: confirmation =====
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.addEventListener('click', () => {
      // Au clic: masquer tout sauf le message de confirmation
      const container = document.querySelector('.container');
      // masquer tout sauf #confirmation, #confirmation doit rester visible
      Array.from(container.children).forEach(child => {
        if(child.id !== 'confirmation'){
          child.classList.add('hidden');
        }
      });
      const conf = document.getElementById('confirmation');
      conf.classList.remove('hidden');
      // Optionnel: scroll vers le message
      conf.scrollIntoView({ behavior:'smooth', block:'start' });
    });
  </script>
</body>
</html>
